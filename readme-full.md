# Antizapret-VPN простая установка на сервер

## Пожалуйста прочитайте полностью прежде чем начинать!
<details>
  <summary>Disclaimer</summary>
  
  Поскольку публиковать способы обхода блокировок доступа к информации, запрещенной на территории Российской Федерации, не очень законно, целью этой установки будет рассказать о методе, позволяющем автоматизировать получение доступа к ресурсам, разрешенным на территории Российской Федерации, но из-за чьих-то действий недоступным напрямую через вашего провайдера. Например компания Intel блокирует доступ к своим адресам из подсетей РФ, а значит невозможно скачать драйвера на оборудование.
  Доступ к другим ресурсам, получаемый в результате действий из статьи, является досадным побочным эффектом и целью статьи ни в коем случае не является.
</details>

## Описание

Antizapret - это проект, направленный на обход региональных блокировок. Antizapret работает на основе OpenVPN и поддерживает его стандартные клиенты для подключения.  
Так же он может работать на различных роутерах с поддержкой OpenVPN клиентов - например Кинетик, OpenWRT, Padavan, Mikrotik...  

После установки и настройки сервера, Вы можете раздать конфигурацию для подключения свои родным и близким, либо установить её на роутер для работы в Вашей локальной сети.

## Как это работает

Antizapret работает следующим образом:
1. **Проверка доменов**: PAC-скрипты проверяют, заблокирован ли запрашиваемый домен.
2. **Перенаправление трафика**: Если домен заблокирован, трафик перенаправляется через VPN сервер.
3. **Доступ к заблокированным ресурсам**: Пользователь получает доступ к заблокированным сайтам через VPN, при этом весь остальной трафик идет напрямую, минуя VPN.

Таким образом, в VPN направляются только запросы к заблокированным сайтам, что позволяет экономить ресурсы и улучшать скорость соединения.

---
## Шаги по установке

### 1. Аренда сервера - ОБЯЗАТЕЛЬНО сервер с виртуализацией KVM. OpenVZ НЕ ПОДХОДИТ
1. Перейдите на сайт провайдера облачных серверов, например, Aeza, pq.hosting, 62yun, HostKey, TimeWeb итд...  
<i>Пожалуйста сравните цены, условия и отзывы!</i>  
<i>Лично я выбрал [Aeza](https://aeza.net/ru?ref=368346)  (ссылка реферальная), но выбор остается за Вами. Я не могу гарантировать хорошую работу того или иного хостинга</i>

2. Зарегистрируйтесь и создайте аккаунт.
3. Создайте новый сервер в локации за границей
4. Выберите операционную систему ubuntu server 22.04
5. Выберите тарифный план (начните с самого дешевого для тестирования), возможно с почасовой оплаты.
6. Завершите создание сервера и получите IP-адрес вашего сервера.

### 2. Подключение к серверу по SSH
1. Скачайте и установите [Putty](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html).  
Очень подробное описание работы Putty доступно тут https://losst.pro/kak-polzovatsya-putty
2. Откройте PuTTY.
3. В поле "Host Name (or IP address)" введите IP-адрес вашего сервера.
4. Убедитесь, что выбран протокол SSH и порт 22.
5. Нажмите "Open".
6. Введите логин (обычно `root`) и пароль, который вы получили при создании сервера.  
При вводе пароля символы не отображаются! Так и должно быть!

### 3. Установка ВПНа
1. Скопируйте строку ниже, вставьте в окно SSH(которое открылось) и нажмите Enter
- При любых всплывающих окнах просто нажимайте ENTER
```sh
curl -o /root/autoinstall-antizapret.sh https://raw.githubusercontent.com/drno88/antizapret-autodeploy/main/autoinstall-antizapret.sh && bash autoinstall-antizapret.sh
```
2. Дождитесь окончания установки
3. Файл конфигурации для ОпенВПН клиента будет доступен в папке /root/client.ovpn
4. **PS** - Добавление собственных сайтов \ доменов
   В консоли сервера вводим команду - 
```sh
lxc exec antizapret-vpn -- /bin/bash -c "mcedit /root/antizapret/config/include-hosts-custom.txt"
```
   откроется редактор MC - добавляем нужные домены в самый конец файла, нажимаем f10 - save
   запускаем команду для обновления списка доменов
```sh
lxc exec antizapret-vpn -- /bin/bash -c "LANG=C.UTF-8 /root/antizapret/doall.sh"
```
   *Чтобы исключить домены редактируем файл* - 
```sh
lxc exec antizapret-vpn -- /bin/bash -c "mcedit /root/antizapret/config/exclude-hosts-custom.txt"
```
   откроется редактор MC - добавляем нужные домены, нажимаем f10 - save
   запускаем команду для обновления списка доменов
```sh
lxc exec antizapret-vpn -- /bin/bash -c "LANG=C.UTF-8 /root/antizapret/doall.sh"
```
### 4. Получение файла OpenVPN

1. Установите [WinSCP](https://winscp.net/eng/download.php) на ваш компьютер, если он еще не установлен.
2. Запустите WinSCP и создайте новое соединение:
   - **Протокол**: SCP
   - **Имя хоста**: IP-адрес вашего сервера
   - **Имя пользователя**: root (или другой пользователь с правами доступа)
   - **Пароль**: ваш пароль для SSH
3. Нажмите "Логин" для подключения к серверу.
4. После успешного подключения, в левой панели WinSCP будет отображаться ваш локальный компьютер, а в правой панели - файлы на сервере.
5. Перейдите в правой панели к директории, где находится файл OpenVPN (например, `/root/`).
6. Найдите файл с расширением `.ovpn` (например, `client.ovpn`).
7. Перетащите файл `.ovpn` из правой панели (сервер) в левую панель (ваш локальный компьютер) для копирования.

Теперь у вас есть файл OpenVPN на вашем локальном компьютере, и вы можете использовать его для подключения к VPN.

### 5. Подключение к OpenVPN серверу с ПК \ Android \ iOS

1. **Скачайте и установите OpenVPN клиент** для вашей платформы:
   - [Windows](https://openvpn.net/client/client-connect-vpn-for-windows/) 
   - [iOS](https://apps.apple.com/us/app/openvpn-connect-openvpn-app/id590379981)
   - [Android](https://play.google.com/store/apps/details?id=net.openvpn.openvpn&hl=en_US)

2. **Импортируйте файл конфигурации**:
   - Откройте OpenVPN клиент на вашем устройстве.
   - Импортируйте файл `.ovpn`, который вы скопировали с сервера.

3. **Подключитесь к VPN**:
   - В OpenVPN клиенте выберите импортированный профиль и нажмите "Connect".

- **Перед тем как настраивать на роутере, проверьте что всё работает на телефоне или ПК!!**
### 6. Настройка [Микротика](https://github.com/drno88/antizapret-autodeploy/blob/main/readme-mikrotik.md) или [Кинетика](https://github.com/drno88/antizapret-autodeploy/blob/main/readme-keenetic.md)
